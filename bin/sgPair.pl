#!/usr/bin/perl

($N)=@ARGV;
$N=10 unless $N;

while (<STDIN>) {
  ($rid, $strand, $chr, $pos, $thirty, $M20, $a, $b, $c, $seq, $Is, $ef)=split();
  die unless $rid=~/(\S+):(\S+)/; ($hex, $sgRNA)=($1,$2);
  die unless $ef=~/EF:f:(\S+)/; $ef=$1;
  $key="$pos.$strand"; $VAL{$key}="$sgRNA\t$strand\t$pos\t$ef";
  push(@POS, $key);
}

$LEN=@POS;
for ($i=$N; $i<$LEN; $i++) {
  $ka=$POS[$i-$N]; $kb=$POS[$i];
  $dist=int($kb)-int($ka);
  print "$VAL{$ka}\t$dist\t$VAL{$kb}\n";
  $HIST{int($dist/100)*100}++;
  $total++;
}

print STDERR "Step=$N\t#pairs=$total\n";
print STDERR "dist\tN\t\%\n";
foreach $x (sort {$a<=>$b} keys %HIST) {
  $n=$HIST{$x};
  $pct=$n*100/$total;
  print STDERR "$x\t$n\t$pct\n";
}

__END__
308489ca1e:TGCATTAGCTATACATAAGA	16	chr14	60999982	30	20M	*	0	0	TCTTATGTATAGCTAATGCA	IIIIIIIIIIIIIIIIIIII	EF:f:0.206825
88a36e506a:TTTCAACCTGTCGATTATAT	0	chr14	61000032	30	20M	*	0	0	TTTCAACCTGTCGATTATAT	IIIIIIIIIIIIIIIIIIII	EF:f:0.161107
4d8222580a:TTAAATCCTATATAATCGAC	16	chr14	61000041	30	20M	*	0	0	GTCGATTATATAGGATTTAA	IIIIIIIIIIIIIIIIIIII	EF:f:0.707029
6c0a8f2228:ATTATATAGGATTTAAAGTC	0	chr14	61000045	30	20M	*	0	0	ATTATATAGGATTTAAAGTC	IIIIIIIIIIIIIIIIIIII	EF:f:0.07047
1ff97224b8:ATGTACTATAGCCTGGGGCA	0	chr14	61000108	30	20M	*	0	0	ATGTACTATAGCCTGGGGCA	IIIIIIIIIIIIIIIIIIII	EF:f:0.30326
4447a9afc:AGGGTTCTTTGCACACACAA	0	chr14	61000147	30	20M	*	0	0	AGGGTTCTTTGCACACACAA	IIIIIIIIIIIIIIIIIIII	EF:f:0.209775
970ea44e71:CAGCTGACACTTTGAAGCCT	0	chr14	61000568	30	20M	*	0	0	CAGCTGACACTTTGAAGCCT	IIIIIIIIIIIIIIIIIIII	EF:f:0.120935
a278f26aff:GGGGTTTCTAGGATGCTATT	0	chr14	61000612	30	20M	*	0	0	GGGGTTTCTAGGATGCTATT	IIIIIIIIIIIIIIIIIIII	EF:f:0.093609
1a478fb9a5:CCTTCTGTGGATGCACTTCA	0	chr14	61000656	30	20M	*	0	0	CCTTCTGTGGATGCACTTCA	IIIIIIIIIIIIIIIIIIII	EF:f:0.289234
590a87f1a:TTCAGGGCATTTAACTCCAA	0	chr14	61000672	30	20M	*	0	0	TTCAGGGCATTTAACTCCAA	IIIIIIIIIIIIIIIIIIII	EF:f:0.235504
